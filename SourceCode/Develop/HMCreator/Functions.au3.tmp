#include-once

;~ N?p các thông s? c?a Auto khi kh?i d?ng
Func FAutoStart()
	FSaveLog(" == FAutoStart ===============================")
	FSettingLoad()
	MainGUIFix()
	FAccLoad()
EndFunc

;~ K?t thúc chuong trình
Func FAutoEnd()
	FSettingSave()
	MainGUISave()
	FSaveLog(" == FAutoEnd =================================")
;	FileClose($LogFile)
	Exit
EndFunc

;~ Xóa ToolTip
Func FToolTipDel()
	ToolTip("")
EndFunc

;~ T?m d?ng chuong trình
Func FAutoPause()
	If Not $AutoPause Then Return
	FSaveLog(" FAutoPause "&$AutoPause)
	While $AutoPause
		Sleep(10)
		LNoticeSet("Pause "&@SEC)
	WEnd
	LNoticeSet("")
EndFunc

;~ ?n hi?n chuong trình
Func FAutoShow($Show = 0)
	Local $Span = 35
	If $Show Then
		BHiddenSet("/\")
		MainGUISetPos($AutoPos[0],$AutoPos[1])
	Else
		$AutoPos = MainGUIGetPos()
		BHiddenSet("\/")
		MainGUISetPos($AutoPos[0],0-$AutoPos[3]+$Span,2)
	EndIf
EndFunc


;~ N?p các thông s? chung c?a chuong trình
Func FSettingLoad()

EndFunc

;~ Luu các thông s? chung c?a chuong trình
Func FSettingSave()

EndFunc

;~ Ghi d? li?u xu?ng file log d? tracking code
Func FSaveLog($Log = "!!!!!!!")
	If Not $SaveLog Then Return
	Local $Data
	If $LogFile == 0 Then $LogFile = FileOpen($LogFileName,1+8)
	$Data = @HOUR&":"&@MIN&":"&@SEC&" "&@MSEC&" | "&$Log
	FileWriteLine($LogFile,$Data)
	ConsoleWrite($Data&@CRLF)
EndFunc

;~ L?y chu?i d? li?u t? file text
Func FT($Patten,$Original = "")
	Local $Text
    If Not FileExists($LangFile) Then
        $File = FileOpen($LangFile,1+8+128)
        FileClose($File)
    EndIf

    $Text = ""
    $File = FileOpen($LangFile)
    While 1
        $Line = FileReadLine($File)
        If @error = -1 Then ExitLoop

        If StringInStr($Line,$Patten&"=") Then
            $Text = StringReplace($Line,$Patten&"=","")
        EndIf
    WEnd
    FileClose($File)

    If $Text == "" Then
		$Text = $Patten
		If $Original Then $Text = $Original
        $File = FileOpen($LangFile,1+8+128)
        FileWriteLine($File,$Patten&"="&$Text)
        FileClose($File)
    EndIf

	Return $Text
EndFunc


;~ Ki?m tra công vi?c k? c?n th?c hi?n
Func FCommandCheck()
    Local $Command,$Pos,$TheTran,$HamDoi
    $Command = $CommandList[0]

    If $Command == -1 Then
        ;X? lý khi không có l?nh nào
    EndIf

    FCommandSplit($Command)
    Switch $CommandCurrent[1]

		Case "TestCase"
;~ 			FTest()

    EndSwitch
EndFunc

;~ Phân tách command
Func FCommandSplit($Command)
    $CommandCurrent = StringSplit($Command,"|")
    Return $CommandCurrent
EndFunc

;~ Thêm 1 công vi?c vào danh sách
Func FCommandAdd($Command)
    If $Command <> $CommandList[0] Then _ArrayInsert($CommandList,0,$Command)
EndFunc

;~ Thêm 1 công vi?c vào danh sách
Func FCommandRemove($Command)
    For $i = 0 To UBound($CommandList)-1
        If $CommandList[$i] == $Command Then
            _ArrayDelete($CommandList,$i)
            Return
        EndIf
    Next
EndFunc

;~ Xóa toàn b? l?nh hi?n t?i
Func FCommandClear()
    ReDim $CommandList[1]
    $CommandList[0] = -1
EndFunc

Func FAccCreating()
	Local $Line,$FaultUpdate,$File,$Acc,$CreateDone

	If Not $Start Then Return

	FHotMailOpen()
	Sleep(1000)
	$Acc = FAccCreate()
	$CreateDone = FHotMailFixCaptcha()

	If $CreateDone Then
		LCountSet($AccCount)
		$Line = _ArrayToString($Acc," | ")
		FSaveLog("Status: Done")
		$File = FileOpen($FileAccount,1+8+128)
		FileWriteLine($File,$Line)
		FileClose($File)
	Else
		$AccCount-=1
	EndIf

	_IEQuit($oIE)

	Sleep(1000)
EndFunc


Func FHotMailFixCaptcha()
	Local $Text,$Check
	$Check = 0

	Sleep(5000)
	_IELoadWait($oIE)

	Do
		$Text = _IEBodyReadText($oIE)
		Sleep(2000)
		If StringInStr($Text,'Already have a Microsoft account') Then ContinueLoop
		If StringInStr($Text,'You have 1 unread message') Then ExitLoop

		If StringInStr($Text,"You've reached the daily limit for creating Microsoft accounts") Then
			MsgBox(0,'Error','Need change VPN account')
			Return False
		EndIf

		$Check+=1
		If $Check>10 Then Return False
	Until 0

	Return True
EndFunc

Func FHotMailOpen()
	Local $URL

	$URL = 'https://signup.live.com/signup.aspx?lic=1'
	$URL = 'https://signup.live.com/signup.aspx?wa=wsignin1.0&rpsnv=11&ct=1357150555&rver=6.1.6206.0&wp=MBI&wreply=http%3a%2f%2fmail.live.com%2fdefault.aspx&id=64855&cbcxt=mai&snsc=1&bk=1357150557&uiflavor=web&mkt=EN-US&lc=1033&lic=1'
	$oIE = _IECreate($URL)

EndFunc

;~ T?o account
Func FAccCreate()
	Local $Input,$Acc[12]

	$AccCount+=1
	$Acc[0] = $AccCount
	$Acc[1] = $FirstName[Random(1,$FirstName[0],1)]
	$Acc[2] = $LastName[Random(1,$LastName[0],1)]
	$Acc[3] = $Mail[Random(1,$Mail[0],1)]&"_"&$Acc[1]&"_"&$Acc[2]&"_"&Random(100,9999,1)
	$Acc[4] = Random(1,28,1)							;Birth-Day
	$Acc[5] = Random(1,12,1)							;Birth-Month
	$Acc[6] = Random(@YEAR-30,@YEAR-20,1)				;Birth-Year
	$Acc[7] = $Gender[Random(0,2,1)]					;Gender
	$Acc[8] = '!@#QWE123qwe'							;Password
	$Acc[9] = 'KR'										;Country
	$Acc[10] = '123456789'								;Phone
	$Acc[11] = 'mrkim@hotmail.com'						;AltEmail

	LDoneSet($Acc[3])

	$Input = _IEGetObjById($oIE,'iFirstName')
	_IEFormElementSetValue($Input,$Acc[1])

	$Input = _IEGetObjById($oIE,'iLastName')
	_IEFormElementSetValue($Input,$Acc[2])

	$Input = _IEGetObjById($oIE,'iBirthDay')
	_IEFormElementOptionSelect($Input, $Acc[4])

	$Input = _IEGetObjById($oIE,'iBirthMonth')
	_IEFormElementOptionSelect($Input, $Acc[5])

	$Input = _IEGetObjById($oIE,'iBirthYear')
	_IEFormElementOptionSelect($Input, $Acc[6])

	$Input = _IEGetObjById($oIE,'iGender')
	_IEFormElementOptionSelect($Input, $Acc[7])

	$Input = _IEGetObjById($oIE,'imembernamelive')
	_IEFormElementSetValue($Input,$Acc[3])

	$Input = _IEGetObjById($oIE,'idomain')
	_IEFormElementOptionSelect($Input, 'hotmail.com')

	$Input = _IEGetObjById($oIE,'iPwd')
	_IEFormElementSetValue($Input,$Acc[8])

	$Input = _IEGetObjById($oIE,'iRetypePwd')
	_IEFormElementSetValue($Input,$Acc[8])

	$Input = _IEGetObjById($oIE,'iCountry')
	_IEFormElementOptionSelect($Input, $Acc[9])

	$Input = _IEGetObjById($oIE,'iSMSCountry')
	_IEFormElementOptionSelect($Input, $Acc[9])

	$Input = _IEGetObjById($oIE,'iPhone')
	_IEFormElementSetValue($Input, $Acc[10])

	$Input = _IEGetObjById($oIE,'iAltEmail')
	_IEFormElementSetValue($Input, $Acc[11])

	ControlSend("[CLASS:IEFrame;]",'','[CLASS:Internet Explorer_Server; INSTANCE:1]','{END}')

	Return $Acc
EndFunc

;~ T?t t?t c? Popup
Func FPopupClose()
	FSaveLog('FPopupClose')
	Local $ie,$Popup1
	$Popup1 = 'http://www.melon.com/cds/sub/web/info_melonNotice.htm'

;~ 	$ie = _IECreate($Popup1,1)
;~ 	_IEQuit($ie)
EndFunc

Func FAccLoad()
	Local $File,$Data

	$File = FileOpen("firstname.txt")
	$Data = FileRead($File)
	Global $FirstName = StringSplit($Data,@CRLF)
	_ArrayDisplay($FirstName)


	$File = FileOpen("lastname.txt")
	$Data = FileRead($File)
	Global $LastName = StringSplit($Data,',')

	$File = FileOpen("mail.txt")
	$Data = FileRead($File)
	Global $Mail = StringSplit($Data,',')

	Global $Gender[3] = ['m','f','u']
EndFunc

